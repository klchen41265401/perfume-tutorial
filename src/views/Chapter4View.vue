<template>
  <div>
    <h1>ç¬¬4ç« ï¼šåˆæˆåŒ–å­¸èˆ‡åæ‡‰æ©Ÿåˆ¶</h1>
    <ChapterNav :prev="{ to: '/chapter/3', label: 'ç¬¬3ç« ï¼šSAR' }" :next="{ to: '/chapter/5', label: 'ç¬¬5ç« ï¼šé…æ–¹å·¥ç¨‹' }" />
    <MoleculeGallery title="ğŸ§ª æœ¬ç« é—œéµåˆ†å­" :molecules="molecules" />
    <hr>

    <h2>4.1 å·¥æ¥­é¦™æ–™åˆæˆï¼šå¾çŸ³åŒ–åŸæ–™åˆ°ç²¾ç·»é¦™æ°£</h2>
    <h3>4.1.1 é¦™èŒ…é†‡åˆæˆè·¯ç·šæ¯”è¼ƒ</h3>
    <p>é¦™èŒ…é†‡ (Citronellol) æ˜¯ç«ç‘°é¦™çš„æ ¸å¿ƒæˆåˆ†ã€‚å·¥æ¥­ä¸Šæœ‰ä¸‰ç¨®ä¸»è¦åˆæˆè·¯ç·šï¼š</p>
    <pre><code>è·¯ç·šAï¼šRhodiumå‚¬åŒ–æ°«åŒ–ï¼ˆTakasagoæ³•ï¼‰
æ­¥é©Ÿ1ï¼šMyrceneç’°åŒ–
Myrcene + Hâ‚‚ â†’ Î²-Pinene [Rh(COD)Cl]â‚‚ + (S,S)-DIOP
ç”¢ç‡ï¼š95%, ee: 99%

æ­¥é©Ÿ2ï¼šç•°æ§‹åŒ–
Î²-Pinene â†’ Citronellal [Lewis acid]
ç”¢ç‡ï¼š88%

æ­¥é©Ÿ3ï¼šé¸æ“‡æ€§é‚„åŸ
Citronellal + Hâ‚‚ â†’ Citronellol [Pd/C]
ç”¢ç‡ï¼š96%

ç¸½ç”¢ç‡ï¼š80%
ç«‹é«”é¸æ“‡æ€§ï¼š>99% ee
æˆæœ¬ï¼š$45/kg (2023)</code></pre>
    <pre><code>è·¯ç·šBï¼šGrignardåæ‡‰ï¼ˆBASFæ³•ï¼‰
æ­¥é©Ÿ1ï¼šGrignardè©¦åŠ‘è£½å‚™
3,7-dimethyl-6-octenal + CHâ‚ƒMgBr â†’ (R)-Citronellol
ç”¢ç‡ï¼š72%, ee: 85% (éœ€è¦æ‹†åˆ†)

æ­¥é©Ÿ2ï¼šæ‰‹æ€§æ‹†åˆ†ï¼ˆé…’çŸ³é…¸æ‹†åˆ†æ³•ï¼‰
ç”¢ç‡ï¼š45% (å–®ä¸€ç•°æ§‹é«”)

ç¸½ç”¢ç‡ï¼š32%
æˆæœ¬ï¼š$65/kg</code></pre>

    <h3>4.1.2 åæ‡‰æ©Ÿåˆ¶æ·±åº¦è§£æ</h3>
    <div class="attention-box">
      <h4>ğŸ”¬ Rhodiumå‚¬åŒ–å¾ªç’°æ©Ÿåˆ¶</h4>
      <pre><code>æ°§åŒ–åŠ æˆéšæ®µï¼š
Rh(I) + Hâ‚‚ â†’ Rh(III)-Hâ‚‚
Î”Gâ€¡ = +18.3 kcal/mol (DFTè¨ˆç®—)

é…é«”äº¤æ›ï¼š
Rh(III)-Hâ‚‚ + Substrate â†’ [Rh(III)-Hâ‚‚-Substrate]
K_eq = 2.4 Ã— 10âµ Mâ»Â¹

é‚„åŸæ¶ˆé™¤ï¼ˆé€Ÿç‡æ±ºå®šæ­¥é©Ÿï¼‰ï¼š
[Rh(III)-Hâ‚‚-Substrate] â†’ Rh(I) + Product
Î”Gâ€¡ = +22.7 kcal/mol
k = 3.2 Ã— 10Â³ sâ»Â¹ (at 80Â°C)</code></pre>
    </div>

    <hr>
    <h2>4.2 ç«‹é«”é¸æ“‡æ€§åˆæˆç­–ç•¥</h2>
    <h3>4.2.1 æ‰‹æ€§è¼”åŠ©åŠ‘è¨­è¨ˆ</h3>
    <p>ä»¥ (R)-(âˆ’)-Carvone åˆæˆç‚ºä¾‹ï¼Œä½¿ç”¨ CBS é‚„åŸï¼š</p>
    <div class="chart-container"><canvas ref="stereoChart" style="max-height: 400px;"></canvas></div>

    <hr>
    <h2>4.3 å‰¯åæ‡‰èˆ‡é›œè³ªæ§åˆ¶</h2>
    <h3>4.3.1 é¦™è‰é†›åˆæˆä¸­çš„å‰¯ç”¢ç‰©åˆ†æ</h3>
    <pre><code>ä¸»åæ‡‰ï¼š
Guaiacol + Glyoxylic acid â†’ Vanillin  ç”¢ç‡ï¼š85%

å‰¯åæ‡‰1ï¼šéåº¦æ°§åŒ–  Vanillin + [O] â†’ Vanillic acid (5%)
å‰¯åæ‡‰2ï¼šè‡ªèº«ç¸®åˆ  2 Vanillin â†’ Dehydrodivanillin (3%)
å‰¯åæ‡‰3ï¼šè„«ç”²åŸºåŒ–  Vanillin â†’ Protocatechualdehyde (2%)
å‰¯åæ‡‰4ï¼šé‚„åŸ      Vanillin + Hâ‚‚ â†’ Vanillyl alcohol (1%)</code></pre>
    <div class="chart-container"><canvas ref="optimizationChart" style="max-height: 400px;"></canvas></div>

    <hr>
    <h2>4.4 ç¶ è‰²åŒ–å­¸æ›¿ä»£æ–¹æ¡ˆ</h2>
    <h3>4.4.1 ç”Ÿç‰©å‚¬åŒ–ï¼šé…¶ä¿ƒåˆæˆ</h3>
    <div class="attention-box">
      <h4>ğŸŒ± é…¶ä¿ƒåˆæˆ vs åŒ–å­¸åˆæˆ</h4>
      <table>
        <thead><tr><th>åƒæ•¸</th><th>åŒ–å­¸å‚¬åŒ–</th><th>é…¶å‚¬åŒ–</th></tr></thead>
        <tbody>
          <tr><td>åæ‡‰æº«åº¦</td><td>80-150Â°C</td><td>25-40Â°C</td></tr>
          <tr><td>å£“åŠ›</td><td>5-50 bar</td><td>1 bar</td></tr>
          <tr><td>ç«‹é«”é¸æ“‡æ€§</td><td>85-95% ee</td><td>>99% ee</td></tr>
          <tr><td>E-factor</td><td>25-100</td><td>5-15</td></tr>
          <tr><td>æˆæœ¬</td><td>$</td><td>$$$</td></tr>
        </tbody>
      </table>
    </div>

    <h3>4.4.2 å¯¦ä¾‹ï¼š(R)-Phenylethanol çš„é…¶ä¿ƒåˆæˆ</h3>
    <pre><code>Acetophenone + NADH â†’ (R)-Phenylethanol + NADâº
[Saccharomyces cerevisiae]

åæ‡‰æ¢ä»¶ï¼š30Â°C, pH 6.5, åº•ç‰© 50 mM, é…µæ¯ 100 g/L
çµæœï¼šè½‰åŒ–ç‡ 92%, ee >99.5%, ç”¢ç‡ 85%, 24h</code></pre>

    <h3>4.4.3 æµå‹•åŒ–å­¸ï¼šé€£çºŒåˆæˆ</h3>
    <p>å¾®åæ‡‰å™¨æŠ€è¡“åœ¨é¦™æ–™åˆæˆä¸­çš„æ‡‰ç”¨ã€‚</p>

    <hr>
    <h2>4.5 å·¥æ¥­æ¡ˆä¾‹ï¼šHedioneÂ® åˆæˆ</h2>
    <h3>4.5.1 Firmenichå°ˆåˆ©è·¯ç·š</h3>
    <p>Hedione (ç”²åŸºäºŒæ°«èŒ‰è‰é…¸é…¯) æ˜¯æœ€é‡è¦çš„åˆæˆé¦™æ–™ä¹‹ä¸€ï¼š</p>
    <pre><code>æ­¥é©Ÿ1ï¼šMichaelåŠ æˆ
Methyl acetoacetate + Methyl vinyl ketone â†’ Michael adduct
å‚¬åŒ–åŠ‘ï¼šNaOEt, 20Â°C, ç”¢ç‡ï¼š88%

æ­¥é©Ÿ2ï¼šåˆ†å­å…§Aldolç¸®åˆ
å‚¬åŒ–åŠ‘ï¼šKOH/EtOH, 60Â°C, ç”¢ç‡ï¼š82%

æ­¥é©Ÿ3ï¼šWittigåæ‡‰
Cyclopentanone + Phâ‚ƒP=CH-COOCHâ‚ƒ â†’ Hedione
THF, 25Â°C, ç”¢ç‡ï¼š76%

ç¸½ç”¢ç‡ï¼š55%, å¹´ç”¢é‡ >1000å™¸, æˆæœ¬ ~$35/kg
GCç´”åº¦ >98%, trans/cis > 95:5</code></pre>

    <div class="chart-container"><canvas ref="synthesisRouteChart" style="max-height: 400px;"></canvas></div>

    <hr>
    <h2>ğŸ“š å»¶ä¼¸é–±è®€</h2>
    <ul>
      <li>Bauer, K. et al. (2001). <em>Common Fragrance and Flavor Materials</em>. Wiley-VCH.</li>
      <li>Sheldon, R.A. (2012). "Fundamentals of Green Chemistry". <em>Chem. Soc. Rev.</em> 41, 1437-1451.</li>
      <li>Anastas, P.T. & Warner, J.C. (1998). <em>Green Chemistry: Theory and Practice</em>. Oxford.</li>
    </ul>

    <ChapterNav :prev="{ to: '/chapter/3', label: 'ç¬¬3ç« ï¼šSAR' }" :next="{ to: '/chapter/5', label: 'ç¬¬5ç« ï¼šé…æ–¹å·¥ç¨‹' }" />
  </div>
</template>

<script>
import { ref, onMounted, onUnmounted } from 'vue'
import { Chart } from 'chart.js/auto'
import ChapterNav from '../components/ChapterNav.vue'
import MoleculeGallery from '../components/MoleculeGallery.vue'

export default {
  name: 'Chapter4View',
  components: { ChapterNav, MoleculeGallery },
  setup() {
    const stereoChart = ref(null)
    const optimizationChart = ref(null)
    const synthesisRouteChart = ref(null)
    let charts = []

    const molecules = [
      { name: 'é¦™èŒ…é†‡ (Citronellol)', smiles: 'CC(CCO)CCC=C(C)C' },
      { name: 'é¦™è‰é†› (Vanillin)', smiles: 'O=Cc1ccc(O)c(OC)c1' },
      { name: 'Hedione', smiles: 'COC(=O)CC1CCC(=O)C1' },
      { name: '(R)-è‹¯ä¹™é†‡', smiles: 'OC(C)c1ccccc1' },
      { name: 'æœˆæ¡‚çƒ¯ (Myrcene)', smiles: 'CC(=C)CCC=C(C)C' }
    ]

    onMounted(() => {
      // Stereo chart â€” compute via Boltzmann
      if (stereoChart.value) {
        const temps = [-20, -10, 0, 10, 20, 25, 30, 40, 50]
        const R = 1.987e-3
        const dG = 2.15
        const eeData = temps.map(t => {
          const T = t + 273.15
          const ratio = Math.exp(-dG / (R * T))
          return Math.abs(100 * (ratio - 1) / (ratio + 1))
        })
        charts.push(new Chart(stereoChart.value, {
          type: 'line',
          data: {
            labels: temps.map(t => t + 'Â°C'),
            datasets: [{ label: 'ee (%)', data: eeData, borderColor: 'rgb(75,192,192)', backgroundColor: 'rgba(75,192,192,0.2)', fill: true, tension: 0.3, borderWidth: 3, pointRadius: 5 }]
          },
          options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { labels: { color: '#cbd5e1' } }, title: { display: true, text: 'ç«‹é«”é¸æ“‡æ€§èˆ‡åæ‡‰æº«åº¦çš„é—œä¿‚', color: '#d4af37', font: { size: 18 } } },
            scales: { y: { min: 80, max: 100, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(51,65,85,0.3)' }, title: { display: true, text: 'ee (%)', color: '#cbd5e1' } }, x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(51,65,85,0.3)' }, title: { display: true, text: 'æº«åº¦ (Â°C)', color: '#cbd5e1' } } }
          }
        }))
      }
      // Optimization chart
      if (optimizationChart.value) {
        const temps2 = [60, 70, 80, 90, 100]
        const yieldData = temps2.map(t => { const k = 2.3e6 * Math.exp(-12000 / (8.314 * (t + 273.15))); return (1 - Math.exp(-k * 3 * 3600)) * 100 })
        const purityData = temps2.map((t, i) => { const imp = 0.3 * Math.exp((t - 80) / 15); return yieldData[i] / (yieldData[i] + imp) * 100 })
        charts.push(new Chart(optimizationChart.value, {
          type: 'line',
          data: {
            labels: temps2.map(t => t + 'Â°C'),
            datasets: [
              { label: 'ç”¢ç‡ (%)', data: yieldData, borderColor: 'rgb(255,99,132)', backgroundColor: 'rgba(255,99,132,0.2)', fill: true, tension: 0.3, borderWidth: 3 },
              { label: 'ç´”åº¦ (%)', data: purityData, borderColor: 'rgb(54,162,235)', backgroundColor: 'rgba(54,162,235,0.2)', fill: true, tension: 0.3, borderWidth: 3 }
            ]
          },
          options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { labels: { color: '#cbd5e1' } }, title: { display: true, text: 'æº«åº¦å°ç”¢ç‡å’Œç´”åº¦çš„å½±éŸ¿', color: '#d4af37', font: { size: 18 } } },
            scales: { y: { min: 70, max: 100, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(51,65,85,0.3)' }, title: { display: true, text: 'ç™¾åˆ†æ¯” (%)', color: '#cbd5e1' } }, x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(51,65,85,0.3)' } } }
          }
        }))
      }
      // Synthesis route radar
      if (synthesisRouteChart.value) {
        charts.push(new Chart(synthesisRouteChart.value, {
          type: 'radar',
          data: {
            labels: ['ç”¢ç‡', 'ç´”åº¦', 'æˆæœ¬æ•ˆç›Š', 'ç’°ä¿æ€§', 'å¯æ“´å±•æ€§', 'ç«‹é«”é¸æ“‡æ€§'],
            datasets: [
              { label: 'Rhodiumå‚¬åŒ–æ³•', data: [95, 99, 70, 65, 85, 99], borderColor: 'rgb(255,99,132)', backgroundColor: 'rgba(255,99,132,0.2)', borderWidth: 2 },
              { label: 'Grignardæ³•', data: [72, 85, 50, 40, 90, 85], borderColor: 'rgb(54,162,235)', backgroundColor: 'rgba(54,162,235,0.2)', borderWidth: 2 },
              { label: 'é…¶å‚¬åŒ–æ³•', data: [85, 99, 40, 95, 50, 99], borderColor: 'rgb(75,192,192)', backgroundColor: 'rgba(75,192,192,0.2)', borderWidth: 2 }
            ]
          },
          options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { labels: { color: '#cbd5e1' } }, title: { display: true, text: 'ä¸åŒåˆæˆè·¯ç·šç¶œåˆè©•ä¼°', color: '#d4af37', font: { size: 18 } } },
            scales: { r: { min: 0, max: 100, ticks: { stepSize: 20, color: '#94a3b8', backdropColor: 'transparent' }, grid: { color: 'rgba(51,65,85,0.3)' }, pointLabels: { color: '#cbd5e1', font: { size: 12 } } } }
          }
        }))
      }
    })
    onUnmounted(() => charts.forEach(c => c.destroy()))

    return { stereoChart, optimizationChart, synthesisRouteChart, molecules }
  }
}
</script>
